from airflow import DAG
from airflow.operators.empty import EmptyOperator
from airflow.operators.python import PythonOperator
from airflow.utils.dates import days_ago
from airflow.exceptions import AirflowFailException

def human_approval(**context):
    approved = context["dag_run"].conf.get("approved", False)
    if not approved:
        raise AirflowFailException("Approval not provided.")
    print("Approved!")

with DAG(
    "human_in_the_loop_dag",
    start_date=days_ago(1),
    schedule=None,
    catchup=False,
) as dag:

    start = EmptyOperator(task_id="start")

    approval = PythonOperator(
        task_id="wait_for_approval",
        python_callable=human_approval,
        provide_context=True,
    )

    end = EmptyOperator(task_id="end")

    start >> approval >> end
